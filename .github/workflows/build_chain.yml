on: [push]
permissions: {}
jobs:
  build-chain:
    permissions: write-all
    runs-on: ubuntu-latest
    steps:
      - name: Echo inside this repo
        run: |
          echo "echo inside TestUpperStream"
      - name: Invoke workflow in another repo
        uses: benc-uk/workflow-dispatch@v1.2.2
        with:
          repo: wuisky/try-dispatched
          ref: master
          token: ${{ secrets.STANDARD_RIGHTS }}
          workflow: workflow.yml
      - name: Wait dispatch
        uses: fountainhead/action-wait-for-check@v1.1.0
        id: wait-for-build-common
        with:
          repo: try-dispatched
          ref: master
          token: ${{ secrets.STANDARD_RIGHTS }}
          checkName: build-chain
          intervalSeconds: 10
      - name: Build failure
        if: steps.wait-for-build-common.outputs.conclusion != 'success'
        uses: actions/github-script@v6.4
        with:
          script: |
            core.setFailed('Build failed!')
